<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#23AAE1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.json">
  <title>Omloop Quiz - De Rode Lantaarn</title>
  <style>
    @font-face {
      font-family: 'KG Summer Storm';
      src: url('assets/fonts/KGSummerStormSmooth.ttf') format('truetype');
      font-weight: normal;
      font-display: swap;
    }
    @font-face {
      font-family: 'KG Summer Storm Rough';
      src: url('assets/fonts/KGSummerStormRough.ttf') format('truetype');
      font-weight: normal;
      font-display: swap;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --blauw: #23AAE1;
      --rood: #C93C3B;
      --zwart: #1A1A1A;
      --wit: #FFFFFF;
      --teal: #4A8B9B;
      --oker: #D4A13E;
      --roze: #B4567D;
      --donkerblauw: #2B5B7A;
      --groen: #2ECC71;
    }

    body {
      font-family: 'Trebuchet MS', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--blauw);
      color: var(--zwart);
      min-height: 100dvh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
    }

    .header {
      background: var(--donkerblauw);
      padding: 12px 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 3px 12px rgba(0,0,0,0.25);
    }

    .header-logo {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      object-fit: cover;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }

    .header-text h1 {
      font-family: 'KG Summer Storm', 'Impact', 'Arial Black', sans-serif;
      font-size: 18px;
      font-weight: normal;
      color: var(--wit);
      letter-spacing: 0.5px;
    }

    .header-text .subtitle {
      font-size: 11px;
      color: rgba(255,255,255,0.7);
    }

    .score-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: var(--donkerblauw);
      border-bottom: 3px solid var(--rood);
    }

    .score-bar .stat { text-align: center; }

    .score-bar .stat-value {
      font-family: 'KG Summer Storm', 'Impact', sans-serif;
      font-size: 24px;
      font-weight: normal;
      color: var(--wit);
    }

    .score-bar .stat-label {
      font-size: 10px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.6);
      letter-spacing: 0.5px;
    }

    .score-color { color: var(--oker) !important; }
    .correct-color { color: var(--groen) !important; }
    .wrong-color { color: var(--rood) !important; }
    .streak-color { color: var(--wit) !important; }

    .progress-container { height: 5px; background: rgba(0,0,0,0.15); }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--rood), var(--oker));
      transition: width 0.3s ease;
      width: 0%;
    }

    .quiz-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px 16px;
    }

    .rider-card {
      background: var(--wit);
      border: 3px solid var(--donkerblauw);
      border-radius: 16px;
      padding: 24px 20px;
      text-align: center;
      width: 100%;
      max-width: 400px;
      margin-bottom: 20px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }

    .rider-card.correct {
      border-color: var(--groen);
      box-shadow: 0 0 0 4px rgba(46, 204, 113, 0.3), 0 4px 16px rgba(0,0,0,0.15);
    }

    .rider-card.wrong {
      border-color: var(--rood);
      box-shadow: 0 0 0 4px rgba(201, 60, 59, 0.3), 0 4px 16px rgba(0,0,0,0.15);
    }

    .rider-number { font-size: 12px; color: var(--teal); margin-bottom: 4px; }

    .rider-name {
      font-family: 'KG Summer Storm', 'Impact', 'Arial Black', sans-serif;
      font-size: 30px;
      font-weight: normal;
      line-height: 1.2;
      color: var(--zwart);
    }

    .feedback {
      font-size: 14px;
      margin-top: 10px;
      font-weight: 700;
      min-height: 20px;
    }

    .feedback .pts { font-size: 12px; opacity: 0.6; }

    .options-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      width: 100%;
      max-width: 400px;
    }

    .option-btn {
      background: var(--wit);
      border: 2px solid var(--donkerblauw);
      border-radius: 12px;
      color: var(--zwart);
      padding: 14px 10px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s ease;
      -webkit-tap-highlight-color: transparent;
      text-align: center;
      line-height: 1.3;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .option-btn:active { transform: scale(0.96); background: rgba(255,255,255,0.8); }
    .option-btn.correct-answer { background: var(--groen); border-color: var(--groen); color: var(--wit); }
    .option-btn.wrong-answer { background: var(--rood); border-color: var(--rood); color: var(--wit); }
    .option-btn.reveal-correct { background: var(--groen); border-color: var(--groen); color: var(--wit); opacity: 0.7; }
    .option-btn:disabled { cursor: default; }

    /* Start screen */
    .start-screen {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 32px 24px;
      text-align: center;
    }

    .start-logo {
      width: 120px; height: 120px; border-radius: 20px;
      object-fit: cover; margin-bottom: 16px;
      box-shadow: 0 6px 24px rgba(0,0,0,0.2);
    }

    .start-screen h2 {
      font-family: 'KG Summer Storm', 'Impact', 'Arial Black', sans-serif;
      font-size: 28px; font-weight: normal; color: var(--wit);
      margin-bottom: 2px; text-shadow: 1px 2px 4px rgba(0,0,0,0.15);
    }

    .start-screen .race-name {
      font-family: 'KG Summer Storm', 'Impact', 'Arial Black', sans-serif;
      font-size: 18px; font-weight: normal; color: var(--zwart); margin-bottom: 20px;
    }

    .mode-cards { display: flex; flex-direction: column; gap: 12px; width: 100%; max-width: 340px; }

    .mode-card {
      background: var(--wit); border: 2px solid var(--donkerblauw); border-radius: 14px;
      padding: 16px 18px; display: flex; align-items: center; gap: 14px;
      cursor: pointer; transition: all 0.15s ease; -webkit-tap-highlight-color: transparent;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: left;
    }

    .mode-card:active { transform: scale(0.97); background: rgba(255,255,255,0.9); }
    .mode-card-icon { font-size: 28px; flex-shrink: 0; width: 36px; text-align: center; }
    .mode-card-text { display: flex; flex-direction: column; }

    .mode-card-title {
      font-family: 'KG Summer Storm', 'Impact', 'Arial Black', sans-serif;
      font-size: 18px; font-weight: normal; color: var(--zwart); line-height: 1.2;
    }

    .mode-card-desc { font-size: 12px; color: var(--teal); margin-top: 2px; line-height: 1.3; }

    .mode-detail { width: 100%; max-width: 340px; text-align: center; }

    .mode-detail-title {
      font-family: 'KG Summer Storm', 'Impact', 'Arial Black', sans-serif;
      font-size: 26px; font-weight: normal; color: var(--wit);
      margin-bottom: 8px; text-shadow: 1px 2px 4px rgba(0,0,0,0.15);
    }

    .mode-detail-desc {
      color: var(--donkerblauw); font-size: 14px; font-weight: 600; line-height: 1.5; margin-bottom: 16px;
    }

    .name-input-wrap { margin-bottom: 16px; }

    .name-input-wrap input {
      background: var(--wit); border: 2px solid var(--donkerblauw); border-radius: 10px;
      padding: 12px 16px; font-size: 16px; font-weight: 600; color: var(--zwart);
      text-align: center; width: 100%; max-width: 220px; outline: none;
      -webkit-tap-highlight-color: transparent; font-family: inherit;
    }

    .name-input-wrap input:focus { border-color: var(--rood); }

    .lb-preview {
      background: rgba(0,0,0,0.1); border-radius: 10px; padding: 12px 16px;
      margin-bottom: 20px; text-align: left;
    }

    .lb-preview-title {
      font-family: 'KG Summer Storm', 'Impact', sans-serif;
      color: var(--wit); font-size: 16px; margin-bottom: 6px; text-align: center;
    }

    .lb-preview-row {
      color: rgba(255,255,255,0.85); font-size: 13px; padding: 3px 0;
      display: flex; justify-content: space-between;
    }

    .lb-preview-row .lb-pts { color: var(--oker); font-weight: 700; }

    .start-btn, .restart-btn {
      background: var(--rood); border: none; border-radius: 14px; color: var(--wit);
      padding: 16px 48px;
      font-family: 'KG Summer Storm', 'Impact', 'Arial Black', sans-serif;
      font-size: 22px; font-weight: normal; cursor: pointer;
      -webkit-tap-highlight-color: transparent; transition: transform 0.15s ease;
      box-shadow: 0 4px 12px rgba(201, 60, 59, 0.4);
    }

    .start-btn:active, .restart-btn:active { transform: scale(0.96); }

    .back-btn {
      background: none; border: 2px solid rgba(255,255,255,0.5); border-radius: 10px;
      color: var(--wit); padding: 10px 24px; font-size: 14px; font-weight: 600;
      cursor: pointer; margin-top: 12px; -webkit-tap-highlight-color: transparent;
    }

    .back-btn:active { transform: scale(0.96); }

    .mode-selector { display: flex; gap: 10px; margin-bottom: 16px; flex-wrap: wrap; justify-content: center; }

    .mode-btn {
      background: var(--wit); border: 2px solid var(--donkerblauw); border-radius: 10px;
      color: var(--donkerblauw); padding: 10px 18px; font-size: 14px; font-weight: 700;
      cursor: pointer; -webkit-tap-highlight-color: transparent; transition: all 0.15s ease;
    }

    .mode-btn.active { border-color: var(--rood); color: var(--wit); background: var(--rood); }

    /* Results screen */
    .results-screen {
      flex: 1; display: flex; flex-direction: column; align-items: center;
      justify-content: flex-start; padding: 32px 24px; text-align: center;
      overflow-y: auto;
    }

    .results-screen h2 {
      font-family: 'KG Summer Storm', 'Impact', 'Arial Black', sans-serif;
      font-size: 32px; font-weight: normal; color: var(--wit); margin-bottom: 4px;
    }

    .results-score {
      font-family: 'KG Summer Storm Rough', 'KG Summer Storm', 'Impact', sans-serif;
      font-size: 56px; font-weight: normal; color: var(--oker);
      text-shadow: 2px 3px 0 rgba(0,0,0,0.2);
    }

    .results-score-label {
      font-size: 14px; color: rgba(255,255,255,0.6); margin-top: -4px;
    }

    .results-detail {
      color: var(--donkerblauw); font-size: 14px; font-weight: 600;
      margin: 8px 0 20px; white-space: pre-line;
    }

    .results-logo {
      width: 60px; height: 60px; border-radius: 14px; object-fit: cover;
      margin-bottom: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .leaderboard {
      width: 100%; max-width: 340px; margin-bottom: 24px;
    }

    .leaderboard h3 {
      font-family: 'KG Summer Storm', 'Impact', sans-serif;
      color: var(--wit); font-size: 20px; font-weight: normal; margin-bottom: 8px;
    }

    .lb-entry {
      background: rgba(255,255,255,0.12); border-radius: 8px;
      padding: 8px 12px; margin-bottom: 5px;
      display: flex; align-items: center; color: var(--wit); font-size: 13px;
    }

    .lb-entry.lb-current {
      background: rgba(255,255,255,0.25); border: 2px solid var(--oker);
    }

    .lb-rank { font-weight: 700; width: 24px; flex-shrink: 0; }
    .lb-name { flex: 1; text-align: left; }
    .lb-score { font-weight: 700; color: var(--oker); }
    .lb-time { font-size: 11px; color: rgba(255,255,255,0.5); margin-left: 8px; width: 40px; text-align: right; }

    .rider-fact { font-size: 13px; color: var(--teal); margin-top: 8px; line-height: 1.4; min-height: 0; }

    .timer-container {
      width: 100%; max-width: 400px; margin-bottom: 14px;
    }

    .timer-track {
      height: 10px; background: rgba(0,0,0,0.15); border-radius: 5px; overflow: hidden;
    }

    .timer-fill {
      height: 100%; width: 100%; border-radius: 5px;
      background: var(--groen);
      transition: width 0.1s linear, background 0.3s ease;
    }

    .timer-fill.warn { background: var(--oker); }
    .timer-fill.danger { background: var(--rood); }

    .timer-points {
      text-align: center;
      font-family: 'KG Summer Storm', 'Impact', sans-serif;
      font-size: 16px; color: var(--oker); margin-top: 4px;
      transition: color 0.3s ease;
    }

    .timer-points.danger { color: var(--rood); }

    .next-btn {
      background: var(--donkerblauw); border: none; border-radius: 12px; color: var(--wit);
      padding: 14px 40px;
      font-family: 'KG Summer Storm', 'Impact', 'Arial Black', sans-serif;
      font-size: 18px; font-weight: normal; cursor: pointer;
      -webkit-tap-highlight-color: transparent; transition: transform 0.15s ease;
      margin-top: 16px; box-shadow: 0 3px 10px rgba(0,0,0,0.15);
    }

    .next-btn:active { transform: scale(0.96); }

    .hidden { display: none !important; }
  </style>
</head>
<body>

  <!-- START SCREEN -->
  <div id="startScreen" class="start-screen">
    <img src="assets/logos/rodelantaarn.jpeg" alt="De Rode Lantaarn" class="start-logo">
    <h2>De Rode Lantaarn</h2>
    <div class="race-name">Omloop Het Nieuwsblad 2026</div>

    <div id="modeSelector" class="mode-cards">
      <div class="mode-card" onclick="showModeDetail('teams')">
        <div class="mode-card-icon">üëï</div>
        <div class="mode-card-text">
          <div class="mode-card-title">Ploegen Quiz</div>
          <div class="mode-card-desc">Welk team? 10 vragen per ronde</div>
        </div>
      </div>
      <div class="mode-card" onclick="showModeDetail('victories')">
        <div class="mode-card-icon">üèÜ</div>
        <div class="mode-card-text">
          <div class="mode-card-title">Overwinningen</div>
          <div class="mode-card-desc">Ken jij de zeges van de top 25?</div>
        </div>
      </div>
      <div class="mode-card" onclick="showModeDetail('transfers')">
        <div class="mode-card-icon">üîÑ</div>
        <div class="mode-card-text">
          <div class="mode-card-title">Transfers 2026</div>
          <div class="mode-card-desc">Wie ging waar naartoe dit seizoen?</div>
        </div>
      </div>
    </div>

    <div id="modeDetail" class="mode-detail hidden">
      <div id="modeDetailContent"></div>
      <div id="lbPreview"></div>
      <div class="name-input-wrap">
        <input type="text" id="playerName" placeholder="Jouw naam" maxlength="20" autocomplete="off">
      </div>
      <button class="start-btn" onclick="startQuiz()">Start Quiz</button>
      <br>
      <button class="back-btn" onclick="showModeSelector()">Terug</button>
    </div>
  </div>

  <!-- QUIZ SCREEN -->
  <div id="quizScreen" class="hidden">
    <div class="header">
      <img src="assets/logos/rodelantaarn.jpeg" alt="DRL" class="header-logo" onclick="confirmHome()">
      <div class="header-text">
        <h1>Omloop Het Nieuwsblad 2026</h1>
        <div class="subtitle" id="headerSubtitle">Ploegen Quiz</div>
      </div>
    </div>
    <div class="score-bar">
      <div class="stat">
        <div class="stat-value score-color" id="scoreDisplay">0</div>
        <div class="stat-label">Score</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="questionNum">1/10</div>
        <div class="stat-label">Vraag</div>
      </div>
      <div class="stat">
        <div class="stat-value streak-color" id="streakCount">0</div>
        <div class="stat-label">Streak</div>
      </div>
      <div class="stat">
        <div class="stat-value correct-color" id="correctCount">0</div>
        <div class="stat-label">Goed</div>
      </div>
    </div>
    <div class="progress-container">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    <div class="quiz-area">
      <div class="rider-card" id="riderCard">
        <div class="rider-number" id="riderNum"></div>
        <div class="rider-name" id="riderName"></div>
        <div class="feedback" id="feedback"></div>
        <div class="rider-fact hidden" id="riderFact"></div>
      </div>
      <div class="timer-container" id="timerBar">
        <div class="timer-track">
          <div class="timer-fill" id="timerFill"></div>
        </div>
        <div class="timer-points" id="timerPoints">1.000 punten</div>
      </div>
      <div class="options-grid" id="optionsGrid"></div>
      <button class="next-btn hidden" id="nextBtn" onclick="nextQuestion()">Volgende</button>
    </div>
  </div>

  <!-- RESULTS SCREEN -->
  <div id="resultsScreen" class="results-screen hidden">
    <img src="assets/logos/rodelantaarn.jpeg" alt="De Rode Lantaarn" class="results-logo">
    <h2>Resultaat</h2>
    <div class="results-score" id="finalScore">0</div>
    <div class="results-score-label">punten</div>
    <div class="results-detail" id="resultsDetail"></div>
    <div class="leaderboard" id="leaderboardSection">
      <h3>Leaderboard</h3>
      <div id="leaderboardList"></div>
    </div>
    <button class="restart-btn" onclick="showStart()">Opnieuw</button>
  </div>

  <script>
    const QUESTIONS_PER_GAME = 10;

    // ========== TEAMS DATA ==========
    const teams = {
      "Uno-X Mobility": ["S√∏ren W√¶renskjold", "Jonas Abrahamsen", "Carl-Frederik B√©vort", "Sven Erik Bystr√∏m", "Markus Hoelgaard", "Erik Nordsaeter Resell", "Rasmus Tiller"],
      "Alpecin - Premier Tech": ["Jasper Philipsen", "Tobias Bayer", "Lennert Belmans", "Kaden Groves", "Edward Planckaert", "Mathieu van der Poel", "Florian S√©n√©chal"],
      "Bahrain Victorious": ["Matej Mohoriƒç", "Kamil Gradek", "Pau Miquel Delgado", "Alec Segaert", "Robert Stannard", "Attila Valter", "Vlad Van Mechelen"],
      "Decathlon CMA CGM": ["Tobias Lund Andresen", "Stefan Bissegger", "Oscar Chamberlain", "Sander De Pestel", "Stan Dewulf", "Oliver Naesen", "Rasmus S√∏jberg Pedersen"],
      "EF Education - EasyPost": ["Kasper Asgreen", "Vincenzo Albanese", "Noah Hobbs", "Mikkel Fr√∏lich Honor√©", "Luke Lamperti", "Colby Simmons", "Marijn van den Berg"],
      "Groupama - FDJ United": ["Valentin Madouas", "Cyril Barthe", "Thibaud Gruel", "Axel Huens", "Johan Jacobs", "Clement Russo", "Bastien Tronchon"],
      "INEOS Grenadiers": ["Michal Kwiatkowski", "Kim Alexander Heiduk", "Magnus Sheffield", "Artem Shmidt", "Ben Swift", "Ben Turner", "Samuel Watson"],
      "Lidl - Trek": ["S√∏ren Kragh Andersen", "Toms Skuji≈Ü≈°", "Albert Withen Philipsen", "Tim Torn Teutenberg", "Edward Theuns", "Mathias Vacek", "Otto Vergaerde"],
      "Lotto - Intermarch√©": ["Arnaud De Lie", "Vito Braet", "Jenno Berckmoes", "Cedric Beullens", "S√©bastien Grignard", "Luca Van Boven", "Roel Van Sintmaartensdijk"],
      "Movistar": ["Roger Adri√†", "Orluis Aular", "Jon Barrenetxea", "Carlos Canal", "Iv√°n Garc√≠a Cortina", "Filip Maciejuk", "Manlio Moro"],
      "NSN Cycling": ["Biniam Girmay", "Lewis Askey", "Guillaume Boivin", "Matis Louvel", "Ryan Mullen", "Riley Sheehan", "Tom Van Asbroeck"],
      "Red Bull - BORA - hansgrohe": ["Jordi Meeus", "Jarrad Drizners", "Laurence Pithie", "Mick van Dijke", "Tim van Dijke", "Arne Marit", "Gianni Vermeersch"],
      "Soudal - Quick Step": ["Yves Lampaert", "Paul Magnier", "Casper Pedersen", "Pepijn Reinderink", "Jonathan Vervenne", "Dylan van Baarle", "Dries Van Gestel"],
      "Jayco AlUla": ["Amaury Capiot", "Dries De Bondt", "Dries De Pooter", "Robert Donaldson", "Anders Foldager", "Jelte Krijnsen", "Kelland O'Brien"],
      "Picnic PostNL": ["John Degenkolb", "Timo de Jong", "Sean Flynn", "Henri-Fran√ßois Renard-Haquin", "Timo Roosen", "Julius van den Berg", "Frank van den Broek"],
      "Visma - Lease a Bike": ["Edoardo Affini", "Matthew Brennan", "Per Strand Hagenes", "Timo Kielich", "Christophe Laporte", "Pietro Mattio", "Axel Zingle"],
      "UAE Emirates XRG": ["Tim Wellens", "Rui Oliveira", "Julius Johansen", "Rune Herregodts", "Sebastian Molano", "Nils Politt", "Florian Vermeersch"],
      "XDS Astana": ["Davide Ballerini", "Alberto Bettiol", "Yevgeniy Fedorov", "Aaron Gate", "Arjen Livyns", "Alessandro Romele", "Mike Teunissen"],
      "Cofidis": ["Piet Allegaert", "Stanislaw Aniolkowski", "Jenthe Biermans", "Alex Kirsch", "Hugo Page", "Alexis Renard", "Dylan Teuns"],
      "Q36.5 Pro Cycling": ["Tom Pidcock", "Aim√© De Gendt", "Frederik Frison", "Xandro Meurisse", "Brent Van Moer", "Alfred Wright", "Nickolas Zukowsky"],
      "Burgos - BH": ["Cl√©ment Alleno", "Georgios Bouglas", "Daniel Cavia Sanz", "Josh Burnett", "Alexandre Mayer", "Vojtech Km√≠nek", "Cesar Macias Estrada"],
      "Tudor Pro Cycling": ["Stefan K√ºng", "Marco Haller", "Petr Kelemen", "Aivaras Mikutis", "Luca Mozzato", "Rick Pluimers", "Matteo Trentin"],
      "Flanders - Baloise": ["Siebe Deweirdt", "Michiel Lambrecht", "Milan Lanhove", "Victor Vercouillie", "Vincent Van Hemelen", "Dylan Vandenstorme", "Ward Vanhoof"],
      "TotalEnergies": ["Alexys Brunel", "Sandy Dujardin", "Thomas Gachignard", "Samuel Leroux", "Thomas Bonnet", "Anthony Turgis", "Baptiste Vadic"],
      "Unibet Rose Rockets": ["Joren Bloem", "Karsten Feldmann", "Matyas Kopecky", "Tomas Kopecky", "Luk√°≈° Kubi≈°", "Niklas Larsen", "Martijn Rasenberg"]
    };

    // ========== RIDER FACTS ==========
    const riderFacts = {
      "S√∏ren W√¶renskjold": "Noors tijdritkampioen en titelverdediger van de Omloop 2025. Won ook het WK tijdrijden U23 in 2022.",
      "Jonas Abrahamsen": "Droeg de bolletjestrui 12 etappes in de Tour de France 2024.",
      "Carl-Frederik B√©vort": "Deense belofte die in 2024 prof werd.",
      "Sven Erik Bystr√∏m": "Werd in 2014 wereldkampioen bij de beloften in Ponferrada.",
      "Markus Hoelgaard": "Noorse allrounder die in 2021 de Arctic Race of Norway won.",
      "Erik Nordsaeter Resell": "Noors talent, werd 2e in Dwars door Vlaanderen 2024.",
      "Rasmus Tiller": "Won een etappe in de Ronde van Denemarken 2021.",
      "Jasper Philipsen": "Won het groene puntenklassement in de Tour 2023 met 4 ritzeges.",
      "Tobias Bayer": "Oostenrijks kampioen op de weg.",
      "Lennert Belmans": "Jonge Belg, knecht in de klassiekers.",
      "Kaden Groves": "Australische sprinter, meerdere Vuelta-etappes.",
      "Edward Planckaert": "Vlaamse klassiekerspecialist. Wielerfamilie pur sang.",
      "Mathieu van der Poel": "Won o.a. de Ronde van Vlaanderen, Parijs-Roubaix en Milaan-San Remo.",
      "Florian S√©n√©chal": "Frans kampioen in 2022.",
      "Matej Mohoriƒç": "Won Milaan-San Remo 2022 met een gewaagde afdaling.",
      "Kamil Gradek": "Pools kampioen op de weg in 2021.",
      "Pau Miquel Delgado": "Neef van wielrenlegende Pedro Delgado.",
      "Alec Segaert": "Europees kampioen tijdrijden bij de beloften in 2023.",
      "Robert Stannard": "Australische allrounder, top-10 in Ardense klassiekers.",
      "Attila Valter": "Eerste Hongaar in de roze trui in de Giro (2021).",
      "Vlad Van Mechelen": "Jonge Belg met Roemeense roots.",
      "Tobias Lund Andresen": "Won het puntenklassement in de Tour Down Under 2026.",
      "Stefan Bissegger": "Meervoudig Zwitsers kampioen tijdrijden.",
      "Oscar Chamberlain": "Jonge Australi√´r, debuut in Europese klassiekers.",
      "Sander De Pestel": "Belgische belofte, prof sinds 2024.",
      "Stan Dewulf": "Was top-10 in Parijs-Roubaix 2021 als neoprofessional.",
      "Oliver Naesen": "Werd 2e in de Ronde van Vlaanderen 2020.",
      "Rasmus S√∏jberg Pedersen": "Won een Vuelta-etappe in 2024.",
      "Kasper Asgreen": "Won de Ronde van Vlaanderen 2021 en E3 Saxo Classic.",
      "Vincenzo Albanese": "Italiaans beloftenkampioen, won Trofeo Laigueglia.",
      "Noah Hobbs": "Jong Amerikaans talent via EF development.",
      "Mikkel Fr√∏lich Honor√©": "Won een Vuelta-etappe en de Coppi e Bartali.",
      "Luke Lamperti": "Amerikaans talent, sterk in punchy koersen.",
      "Colby Simmons": "Jong Amerikaans talent in het Europese peloton.",
      "Marijn van den Berg": "Won etappes in Parijs-Nice.",
      "Valentin Madouas": "Werd 2e in de Ronde van Vlaanderen 2022.",
      "Cyril Barthe": "Franse klimmer in de Vlaamse kasseikoersen.",
      "Thibaud Gruel": "Specialist in heuvelachtige eendagskoersen.",
      "Axel Huens": "Belgische neoprofessional uit de Groupama kweekschool.",
      "Johan Jacobs": "Zwitserse Luxemburger, wegkapitein in de klassiekers.",
      "Clement Russo": "Sterk in het werk voor de kopmannen.",
      "Bastien Tronchon": "Specialist in heuvelige eendagskoersen.",
      "Michal Kwiatkowski": "Wereldkampioen 2014. Won Milaan-San Remo en Strade Bianche.",
      "Kim Alexander Heiduk": "Jonge Duitser, prof bij INEOS sinds 2024.",
      "Magnus Sheffield": "Won de Brabantse Pijl op 19-jarige leeftijd.",
      "Artem Shmidt": "Sterk ontwikkeld in het peloton.",
      "Ben Swift": "Britse routinier, 15+ jaar prof.",
      "Ben Turner": "Britse kasseispecialist met veldritachtergrond.",
      "Samuel Watson": "Won de Ronde van Groot-Brittanni√´ 2024 op 20-jarige leeftijd.",
      "S√∏ren Kragh Andersen": "Won twee Tour de France-etappes in 2020.",
      "Toms Skuji≈Ü≈°": "Letse puncher, won een etappe in de Tour of California.",
      "Albert Withen Philipsen": "Naamgenoot (geen familie) van Jasper Philipsen.",
      "Tim Torn Teutenberg": "Zoon van wielrenster Ina-Yoko Teutenberg.",
      "Edward Theuns": "Belgisch kampioen op de weg in 2019.",
      "Mathias Vacek": "Won het EK op de weg bij de beloften.",
      "Otto Vergaerde": "Vlaamse kasseispecialist.",
      "Arnaud De Lie": "Won als 20-jarige al meerdere semi-klassiekers.",
      "Vito Braet": "Opkwam via de Lotto opleidingsploeg.",
      "Jenno Berckmoes": "Overstap naar WorldTour in 2024.",
      "Cedric Beullens": "Specialist in de kortere klassiekers.",
      "S√©bastien Grignard": "Sterk in zowel tijdritten als eendagskoersen.",
      "Luca Van Boven": "Toekomstige klassiekerrenner.",
      "Roel Van Sintmaartensdijk": "Langste achternaam in het peloton.",
      "Roger Adri√†": "Spaanse klimmer die ook de klassiekers ontdekt.",
      "Orluis Aular": "Venezolaans kampioen op de weg.",
      "Jon Barrenetxea": "Jonge Bask uit de Movistar-kweekvijver.",
      "Carlos Canal": "Spaanse neoprofessional.",
      "Iv√°n Garc√≠a Cortina": "Was top-10 in Parijs-Roubaix en de Ronde.",
      "Filip Maciejuk": "Sterk in korte tijdritten en prologes.",
      "Manlio Moro": "Jong Europees kampioen tijdrijden.",
      "Biniam Girmay": "Eerste Afrikaanse winnaar van Gent-Wevelgem (2022).",
      "Lewis Askey": "Winnaar Le Samyn 2024, veldritachtergrond.",
      "Guillaume Boivin": "Canadese routinier in eendagskoersen.",
      "Matis Louvel": "Bekend om zijn solo-ontsnappingen.",
      "Ryan Mullen": "Meervoudig Iers tijdritkampioen.",
      "Riley Sheehan": "Debuut in het Vlaamse Opening Weekend.",
      "Tom Van Asbroeck": "10+ jaar ervaring in het profpeloton.",
      "Jordi Meeus": "Won een Tour de France-etappe in 2023.",
      "Jarrad Drizners": "Australische allrounder in de Europese koersen.",
      "Laurence Pithie": "Won Dwars door Vlaanderen 2024 op 22-jarige leeftijd.",
      "Mick van Dijke": "Nederlandse tweeling samen met Tim.",
      "Tim van Dijke": "Tweelingbroer van Mick, sterk op de hellingen.",
      "Arne Marit": "Won GP Marcel Kint 2023.",
      "Gianni Vermeersch": "Veldrijden, mountainbike √©n weg. 4e in Parijs-Roubaix 2021.",
      "Yves Lampaert": "Won de openingstijdrit van de Tour 2022 in Kopenhagen.",
      "Paul Magnier": "Frans supertalent, pas 19 jaar.",
      "Casper Pedersen": "Won Parijs-Tours 2020.",
      "Pepijn Reinderink": "Ontwikkelt zich bij het Wolfpack.",
      "Jonathan Vervenne": "Neoprofessional uit de SQS opleidingsploeg.",
      "Dylan van Baarle": "Won Parijs-Roubaix 2022 solo op recordsnelheid.",
      "Dries Van Gestel": "Sterk op de Vlaamse hellingen en kasseistroken.",
      "Amaury Capiot": "Won een Vuelta-etappe in 2022.",
      "Dries De Bondt": "Belgisch kampioen op de weg 2022.",
      "Dries De Pooter": "Debuut in het WorldTour-peloton.",
      "Robert Donaldson": "Specialist in dienst rijden.",
      "Anders Foldager": "Sterk in heuvelachtige eendagskoersen.",
      "Jelte Krijnsen": "Uit de Jayco-opleidingsploeg.",
      "Kelland O'Brien": "Olympisch medaillewinnaar op de baan.",
      "John Degenkolb": "Won Milaan-San Remo √©n Parijs-Roubaix in 2015.",
      "Timo de Jong": "Jonge Nederlander bij Picnic PostNL.",
      "Sean Flynn": "Iers talent in het profpeloton.",
      "Henri-Fran√ßois Renard-Haquin": "Langste naam in het peloton.",
      "Timo Roosen": "Meervoudig Nederlands kampioen op de weg.",
      "Julius van den Berg": "Broer van Lars van den Berg.",
      "Frank van den Broek": "Won een Parijs-Nice etappe in 2024 als neoprofessional.",
      "Edoardo Affini": "Meervoudig Italiaans kampioen tijdrijden.",
      "Matthew Brennan": "Brits supertalent, toekomstige klassiekertopper.",
      "Per Strand Hagenes": "Wereldkampioen bij de junioren in 2021.",
      "Timo Kielich": "Combineert veldrijden en wegwielrennen.",
      "Christophe Laporte": "Won de Omloop Het Nieuwsblad in 2022.",
      "Pietro Mattio": "Italiaanse klimmer in de Vlaamse koersen.",
      "Axel Zingle": "Franse veldrijder met explosief vermogen.",
      "Tim Wellens": "Won 3x de Brabantse Pijl en meerdere Giro-etappes.",
      "Rui Oliveira": "Portugese wegkapitein.",
      "Julius Johansen": "Deense neoprofessional bij UAE.",
      "Rune Herregodts": "Belgisch kampioen tijdrijden, offensieve koersstijl.",
      "Sebastian Molano": "Won meerdere Vuelta-etappes.",
      "Nils Politt": "Was 2e in Parijs-Roubaix 2019, won een Tour-etappe.",
      "Florian Vermeersch": "Werd 2e in Parijs-Roubaix 2021 als neoprofessional.",
      "Davide Ballerini": "Won de Omloop Het Nieuwsblad in 2021.",
      "Alberto Bettiol": "Won de Ronde van Vlaanderen 2019.",
      "Yevgeniy Fedorov": "Kazachse sprinter, won Tour of Oman-etappes.",
      "Aaron Gate": "Meervoudig Nieuw-Zeelands kampioen.",
      "Arjen Livyns": "Belgische klassiekerknecht.",
      "Alessandro Romele": "Neoprofessional uit het development team.",
      "Mike Teunissen": "Droeg de gele trui in de Tour 2019.",
      "Piet Allegaert": "Top-10 in Gent-Wevelgem 2020.",
      "Stanislaw Aniolkowski": "Sterk als aanvaller in eendagskoersen.",
      "Jenthe Biermans": "Was 3e in Dwars door Vlaanderen.",
      "Alex Kirsch": "Luxemburgs kampioen op de weg.",
      "Hugo Page": "Olympisch goud op de baan in 2024.",
      "Alexis Renard": "Frans kampioen op de weg 2023.",
      "Dylan Teuns": "Won twee Tour-etappes.",
      "Tom Pidcock": "Olympisch kampioen mountainbike 2021, won Amstel Gold Race 2024.",
      "Aim√© De Gendt": "Broer van Thomas De Gendt.",
      "Frederik Frison": "Specialist op de ruige wegen van Noord-Frankrijk.",
      "Xandro Meurisse": "Was top-10 in Luik-Bastenaken-Luik en de Ronde.",
      "Brent Van Moer": "Won een Dauphin√©-etappe, sterk tijdrijder.",
      "Alfred Wright": "Brits talent, prof bij Q36.5 sinds 2024.",
      "Nickolas Zukowsky": "Canadese klimmer-puncheur.",
      "Cl√©ment Alleno": "Grijpt zijn kansen bij het Spaanse ProTeam.",
      "Georgios Bouglas": "Een van de weinige Grieken in het profpeloton.",
      "Daniel Cavia Sanz": "Neoprofessional uit het Burgos-opleidingsteam.",
      "Josh Burnett": "Via continentale teams het profpeloton bereikt.",
      "Alexandre Mayer": "Combineert sprint en punch-vermogen.",
      "Vojtech Km√≠nek": "Sterk in heuvelachtige wedstrijden.",
      "Cesar Macias Estrada": "Een van de weinige Mexicanen in het peloton.",
      "Stefan K√ºng": "Meervoudig Europees kampioen tijdrijden.",
      "Marco Haller": "Won een etappe in de Tour of Britain.",
      "Petr Kelemen": "Prof bij Tudor sinds 2024.",
      "Aivaras Mikutis": "Een van de weinige Litouwers in het peloton.",
      "Luca Mozzato": "Was 3e in Milaan-San Remo 2023.",
      "Rick Pluimers": "Uit de Tudor-opleidingsploeg.",
      "Matteo Trentin": "Europees kampioen 2018, won etappes in alle grote rondes.",
      "Siebe Deweirdt": "Specialist op de lokale kermiskoersen.",
      "Michiel Lambrecht": "Vlaamse klassiekerambities.",
      "Milan Lanhove": "Uit West-Vlaanderen, hart van de wielercultuur.",
      "Victor Vercouillie": "Rijdt vandaag zijn thuiskoers.",
      "Vincent Van Hemelen": "Neoprofessional bij het Vlaamse ProTeam.",
      "Dylan Vandenstorme": "Sterk op de Vlaamse wegen.",
      "Ward Vanhoof": "Sterk op de kasseistroken.",
      "Alexys Brunel": "Broer van Marc Brunel.",
      "Sandy Dujardin": "Ontwikkelt zich in het profpeloton.",
      "Thomas Gachignard": "Neoprofessional uit de TotalEnergies-kweekvijver.",
      "Samuel Leroux": "Won beloftenkoersen in Frankrijk.",
      "Thomas Bonnet": "Sterk in dienst van de ploeg.",
      "Anthony Turgis": "Won een epische graveletappe in de Tour 2024.",
      "Baptiste Vadic": "Eerste seizoen in de klassiekers.",
      "Joren Bloem": "Bij het ambitieuze Nederlandse ProTeam.",
      "Karsten Feldmann": "Debuut in het Vlaamse Opening Weekend.",
      "Matyas Kopecky": "Broer van Tomas Kopecky.",
      "Tomas Kopecky": "Broer van Matyas, beiden bij Unibet Rose Rockets.",
      "Luk√°≈° Kubi≈°": "Maakt indruk in de semi-klassiekers.",
      "Niklas Larsen": "Olympisch medaillewinnaar op de ploegenachtervolging.",
      "Martijn Rasenberg": "Sterk voorjaar in de kermiskoersen."
    };

    const famousRiders = [
      "Mathieu van der Poel", "Jasper Philipsen", "S√∏ren W√¶renskjold", "Tom Pidcock",
      "Christophe Laporte", "Matthew Brennan", "Tim Wellens",
      "Kasper Asgreen", "Biniam Girmay", "Michal Kwiatkowski", "Arnaud De Lie",
      "Dylan van Baarle", "Paul Magnier", "Alberto Bettiol", "Stefan K√ºng",
      "Matteo Trentin", "Oliver Naesen", "Tobias Lund Andresen", "Jordi Meeus",
      "Ben Turner", "Magnus Sheffield", "Nils Politt", "Florian Vermeersch",
      "Yves Lampaert", "John Degenkolb", "Matej Mohoriƒç", "Kaden Groves",
      "Toms Skuji≈Ü≈°", "Luca Mozzato", "Dylan Teuns", "Anthony Turgis",
      "Marco Haller", "Alec Segaert", "Iv√°n Garc√≠a Cortina", "Brent Van Moer",
      "Laurence Pithie", "Gianni Vermeersch", "Xandro Meurisse", "Edward Theuns",
      "Samuel Watson", "Marijn van den Berg", "Valentin Madouas", "Piet Allegaert",
      "Lewis Askey", "Amaury Capiot", "Luk√°≈° Kubi≈°", "Axel Zingle",
      "Florian S√©n√©chal", "Mike Teunissen", "Edoardo Affini"
    ];

    // ========== VICTORIES DATA ==========
    const victoriesData = [
      { rider: "Mathieu van der Poel", victory: "Ronde van Vlaanderen 2020", desc: "Legendarische sprint met Wout van Aert in de Vlaamse Ardennen" },
      { rider: "Jasper Philipsen", victory: "Milaan-San Remo 2024", desc: "Eerste Monument voor de Belgische topsprinter" },
      { rider: "S√∏ren W√¶renskjold", victory: "Omloop Het Nieuwsblad 2025", desc: "Verrassende solowinst als titelverdediger" },
      { rider: "Tom Pidcock", victory: "Strade Bianche 2023", desc: "Solo over de witte grindwegen van Toscane" },
      { rider: "Christophe Laporte", victory: "Gent-Wevelgem 2023", desc: "Imposante sprint na een zware klassieker" },
      { rider: "Matthew Brennan", victory: "Ronde van Noorwegen 2025", desc: "Eindzege in zijn doorbraakseizoen" },
      { rider: "Tim Wellens", victory: "Ronde van Polen 2016", desc: "Eindzege met meer dan 4 minuten voorsprong" },
      { rider: "Kasper Asgreen", victory: "Ronde van Vlaanderen 2021", desc: "Versloeg favoriet Van der Poel in de sprint" },
      { rider: "Biniam Girmay", victory: "Gent-Wevelgem 2022", desc: "Eerste Afrikaanse winnaar van een grote klassieker" },
      { rider: "Michal Kwiatkowski", victory: "Milaan-San Remo 2017", desc: "Sprint met drie renners over de Poggio" },
      { rider: "Arnaud De Lie", victory: "Renewi Tour 2025", desc: "Versloeg Van der Poel in het klassement" },
      { rider: "Dylan van Baarle", victory: "Parijs-Roubaix 2022", desc: "Solo op recordsnelheid door de Hel van het Noorden" },
      { rider: "Paul Magnier", victory: "GP de Fourmies 2025", desc: "Belangrijke zege in een doorbraakseizoen" },
      { rider: "Alberto Bettiol", victory: "Ronde van Vlaanderen 2019", desc: "Verrassende solo, meteen eerste profzege in een Monument" },
      { rider: "Stefan K√ºng", victory: "EK Tijdrijden 2020", desc: "Dominante overwinning met 17 seconden voorsprong" },
      { rider: "Matteo Trentin", victory: "EK Wegrit 2018", desc: "Solo van 12 km, voor Van der Poel en Van Aert" },
      { rider: "Oliver Naesen", victory: "Bretagne Classic 2016", desc: "Zijn eerste en grootste WorldTour-overwinning" },
      { rider: "Tobias Lund Andresen", victory: "Cadel Evans Road Race 2026", desc: "Krachtige sprint in zijn grootste zege" },
      { rider: "Jordi Meeus", victory: "Tour 2023 - Champs-√âlys√©es", desc: "Sprintzege op de beroemdste finishlijn" },
      { rider: "Ben Turner", victory: "Vuelta 2025 - Etappe 4", desc: "Emotionele sprintzege, grootste overwinning" },
      { rider: "Magnus Sheffield", victory: "Brabantse Pijl 2022", desc: "Solo op 19-jarige leeftijd" },
      { rider: "Nils Politt", victory: "Tour 2021 - Etappe 12", desc: "Solowinst uit de vroege vlucht naar N√Æmes" },
      { rider: "Florian Vermeersch", victory: "WK Gravel 2025", desc: "Wereldkampioen gravel na twee keer zilver" },
      { rider: "Yves Lampaert", victory: "Tour 2022 - Tijdrit Kopenhagen", desc: "Verrassende winst in de regen, voor Van Aert en Pogaƒçar" },
      { rider: "John Degenkolb", victory: "Parijs-Roubaix 2015", desc: "Onderdeel van een legendarische dubbel met Milaan-San Remo" }
    ];

    // ========== TRANSFERS DATA ==========
    const transfersData = [
      { rider: "Remco Evenepoel", from: "Soudal - Quick Step", to: "Red Bull - BORA - hansgrohe", trap: "Soudal - Quick Step", transferred: true },
      { rider: "Tom Pidcock", from: "INEOS Grenadiers", to: "Q36.5 Pro Cycling", trap: "INEOS Grenadiers", transferred: true },
      { rider: "Juan Ayuso", from: "UAE Emirates XRG", to: "Lidl - Trek", trap: "UAE Emirates XRG", transferred: true },
      { rider: "Cian Uijtdebroeks", from: "Visma - Lease a Bike", to: "Movistar", trap: "Visma - Lease a Bike", transferred: true },
      { rider: "Dylan Groenewegen", from: "Jayco AlUla", to: "Unibet Rose Rockets", trap: "Jayco AlUla", transferred: true },
      { rider: "Stefan K√ºng", from: "Groupama - FDJ United", to: "Tudor Pro Cycling", trap: "Groupama - FDJ United", transferred: true },
      { rider: "Olav Kooij", from: "Visma - Lease a Bike", to: "Decathlon CMA CGM", trap: "Visma - Lease a Bike", transferred: true },
      { rider: "Dylan van Baarle", from: "Visma - Lease a Bike", to: "Soudal - Quick Step", trap: "Visma - Lease a Bike", transferred: true },
      { rider: "Jasper Stuyven", from: "Lidl - Trek", to: "Soudal - Quick Step", trap: "Lidl - Trek", transferred: true },
      { rider: "Tiesj Benoot", from: "Visma - Lease a Bike", to: "Decathlon CMA CGM", trap: "Visma - Lease a Bike", transferred: true },
      { rider: "Oscar Onley", from: "Picnic PostNL", to: "INEOS Grenadiers", trap: "Picnic PostNL", transferred: true },
      { rider: "K√©vin Vauquelin", from: "Ark√©a-B&B Hotels", to: "INEOS Grenadiers", trap: null, transferred: true },
      { rider: "Florian S√©n√©chal", from: "Ark√©a-B&B Hotels", to: "Alpecin - Premier Tech", trap: null, transferred: true },
      { rider: "Quinten Hermans", from: "Alpecin-Deceuninck", to: "Q36.5 Pro Cycling", trap: "Alpecin - Premier Tech", transferred: true },
      { rider: "Beno√Æt Cosnefroy", from: "Decathlon CMA CGM", to: "UAE Emirates XRG", trap: "Decathlon CMA CGM", transferred: true },
      { rider: "Sam Bennett", from: "Decathlon CMA CGM", to: "Q36.5 Pro Cycling", trap: "Decathlon CMA CGM", transferred: true },
      { rider: "Wout Poels", from: "XDS Astana", to: "Unibet Rose Rockets", trap: "XDS Astana", transferred: true },
      { rider: "Dorian Godon", from: "Decathlon CMA CGM", to: "INEOS Grenadiers", trap: "Decathlon CMA CGM", transferred: true },
      { rider: "Alberto Dainese", from: "Tudor Pro Cycling", to: "Soudal - Quick Step", trap: "Tudor Pro Cycling", transferred: true },
      { rider: "Mattia Cattaneo", from: "Soudal - Quick Step", to: "Red Bull - BORA - hansgrohe", trap: "Soudal - Quick Step", transferred: true },
      { rider: "Mathieu van der Poel", team: "Alpecin - Premier Tech", transferred: false },
      { rider: "Tadej Pogaƒçar", team: "UAE Emirates XRG", transferred: false },
      { rider: "Wout van Aert", team: "Visma - Lease a Bike", transferred: false },
      { rider: "Jasper Philipsen", team: "Alpecin - Premier Tech", transferred: false },
      { rider: "Tim Merlier", team: "Soudal - Quick Step", transferred: false },
      { rider: "Jonas Vingegaard", team: "Visma - Lease a Bike", transferred: false },
      { rider: "Arnaud De Lie", team: "Lotto - Intermarch√©", transferred: false },
      { rider: "Mads Pedersen", team: "Lidl - Trek", transferred: false }
    ];

    // ========== BUILD LOOKUPS ==========
    const riderTeamMap = {};
    const teamNames = Object.keys(teams);
    for (const [team, riders] of Object.entries(teams)) {
      for (const rider of riders) riderTeamMap[rider] = team;
    }
    const allRiders = Object.keys(riderTeamMap);

    // ========== STATE ==========
    let gameMode = null;
    let difficultyMode = '25';
    let quizQuestions = [];
    let currentIndex = 0;
    let correct = 0;
    let wrong = 0;
    let streak = 0;
    let bestStreak = 0;
    let answering = false;
    let totalScore = 0;
    let questionStartTime = 0;
    let totalTimeMs = 0;
    let timerInterval = null;
    const TIMER_DURATION = 10000; // 10 seconden
    let currentEntryId = null;
    let playerName = '';

    // ========== UTILITY ==========
    function shuffle(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function getBaseRace(v) {
      if (v.startsWith('Tour ')) return 'Tour de France';
      if (v.startsWith('Vuelta')) return 'Vuelta';
      if (v.startsWith('Giro')) return 'Giro';
      return v.replace(/\s+\d{4}.*$/, '');
    }

    function fmtScore(n) {
      return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
    }

    function fmtTime(ms) {
      return (ms / 1000).toFixed(1) + 's';
    }

    // ========== LEADERBOARD ==========
    function getLbKey() {
      if (gameMode === 'teams') return 'lb_teams_' + difficultyMode;
      return 'lb_' + gameMode;
    }

    function loadLb() {
      return JSON.parse(localStorage.getItem(getLbKey()) || '[]');
    }

    function saveLb(name, score, timeMs, correct) {
      const key = getLbKey();
      const lb = loadLb();
      const id = Date.now();
      lb.push({ name, score, time: timeMs, correct, id });
      lb.sort((a, b) => b.score - a.score);
      if (lb.length > 50) lb.length = 50;
      localStorage.setItem(key, JSON.stringify(lb));
      return { lb, id };
    }

    function renderLbPreview() {
      const lb = loadLb();
      const el = document.getElementById('lbPreview');
      if (lb.length === 0) { el.innerHTML = ''; return; }
      const top = lb.slice(0, 3);
      let html = '<div class="lb-preview"><div class="lb-preview-title">Top scores</div>';
      top.forEach((e, i) => {
        html += `<div class="lb-preview-row"><span>${i + 1}. ${e.name}</span><span class="lb-pts">${fmtScore(e.score)}</span></div>`;
      });
      html += '</div>';
      el.innerHTML = html;
    }

    function renderLb(lb, highlightId) {
      const el = document.getElementById('leaderboardList');
      const top = lb.slice(0, 10);
      let html = '';
      top.forEach((e, i) => {
        const cls = e.id === highlightId ? ' lb-current' : '';
        html += `<div class="lb-entry${cls}">
          <span class="lb-rank">${i + 1}.</span>
          <span class="lb-name">${e.name}</span>
          <span class="lb-score">${fmtScore(e.score)}</span>
          <span class="lb-time">${fmtTime(e.time)}</span>
        </div>`;
      });
      el.innerHTML = html;
    }

    // ========== SCORING ==========
    function calcPoints(elapsedMs) {
      const secs = Math.min(elapsedMs, TIMER_DURATION) / 1000;
      return Math.max(100, Math.round(1000 - secs * 100));
    }

    function startTimer() {
      const fill = document.getElementById('timerFill');
      const pts = document.getElementById('timerPoints');
      const bar = document.getElementById('timerBar');
      bar.classList.remove('hidden');
      fill.style.width = '100%';
      fill.classList.remove('warn', 'danger');
      pts.classList.remove('danger');
      pts.textContent = '1.000 punten';

      timerInterval = setInterval(() => {
        const elapsed = Date.now() - questionStartTime;
        const remaining = Math.max(0, TIMER_DURATION - elapsed);
        const pct = (remaining / TIMER_DURATION) * 100;
        const currentPts = calcPoints(elapsed);

        fill.style.width = pct + '%';
        pts.textContent = fmtScore(currentPts) + ' punten';

        // Kleur wijzigen op basis van resterende tijd
        if (pct <= 30) {
          fill.classList.add('danger');
          fill.classList.remove('warn');
          pts.classList.add('danger');
        } else if (pct <= 60) {
          fill.classList.add('warn');
          fill.classList.remove('danger');
          pts.classList.remove('danger');
        }

        // Tijd op!
        if (remaining <= 0) {
          clearInterval(timerInterval);
          timerInterval = null;
          pts.textContent = 'Tijd op!';
          if (!answering) handleTimeUp();
        }
      }, 50);
    }

    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }

    function handleTimeUp() {
      answering = true;
      const elapsed = TIMER_DURATION;
      totalTimeMs += elapsed;

      const q = quizQuestions[currentIndex];
      const card = document.getElementById('riderCard');
      const buttons = document.querySelectorAll('.option-btn');

      wrong++;
      streak = 0;
      card.classList.add('wrong');
      document.getElementById('feedback').innerHTML =
        `<span style="color:#C93C3B">${q.correctAnswer}</span>`;
      document.getElementById('streakCount').textContent = streak;

      if (q.fact) {
        const factEl = document.getElementById('riderFact');
        factEl.textContent = q.fact;
        factEl.classList.remove('hidden');
      }

      buttons.forEach(btn => {
        btn.disabled = true;
        if (btn.dataset.answer === q.correctAnswer) {
          btn.classList.add('reveal-correct');
        }
      });

      document.getElementById('nextBtn').classList.remove('hidden');
    }

    // ========== START SCREEN ==========
    function showModeDetail(mode) {
      gameMode = mode;
      document.getElementById('modeSelector').classList.add('hidden');
      document.getElementById('modeDetail').classList.remove('hidden');

      // Restore saved name
      const saved = localStorage.getItem('playerName') || '';
      document.getElementById('playerName').value = saved;

      const content = document.getElementById('modeDetailContent');

      if (mode === 'teams') {
        difficultyMode = '25';
        content.innerHTML = `
          <div class="mode-detail-title">Ploegen Quiz</div>
          <p class="mode-detail-desc">Kies het juiste team voor elke renner.<br>10 vragen per ronde!</p>
          <div class="mode-selector">
            <button class="mode-btn active" data-diff="25" onclick="selectDifficulty('25')">Top 25</button>
            <button class="mode-btn" data-diff="50" onclick="selectDifficulty('50')">Top 50</button>
            <button class="mode-btn" data-diff="all" onclick="selectDifficulty('all')">Alle 175</button>
          </div>
        `;
      } else if (mode === 'victories') {
        content.innerHTML = `
          <div class="mode-detail-title">Overwinningen</div>
          <p class="mode-detail-desc">Welke koers won deze renner?<br>10 vragen uit de top 25!</p>
        `;
      } else if (mode === 'transfers') {
        content.innerHTML = `
          <div class="mode-detail-title">Transfers 2026</div>
          <p class="mode-detail-desc">Bij welk team rijdt deze renner in 2026?<br>Let op de transfers!</p>
        `;
      }

      renderLbPreview();
    }

    function showModeSelector() {
      document.getElementById('modeDetail').classList.add('hidden');
      document.getElementById('modeSelector').classList.remove('hidden');
    }

    function selectDifficulty(diff) {
      difficultyMode = diff;
      document.querySelectorAll('.mode-btn').forEach(b => {
        b.classList.toggle('active', b.dataset.diff === diff);
      });
      renderLbPreview();
    }

    // ========== QUIZ ENGINE ==========
    function startQuiz() {
      playerName = document.getElementById('playerName').value.trim();
      if (!playerName) {
        document.getElementById('playerName').focus();
        document.getElementById('playerName').style.borderColor = '#C93C3B';
        return;
      }
      localStorage.setItem('playerName', playerName);

      if (gameMode === 'teams') generateTeamQuestions();
      else if (gameMode === 'victories') generateVictoryQuestions();
      else if (gameMode === 'transfers') generateTransferQuestions();

      currentIndex = 0;
      correct = 0;
      wrong = 0;
      streak = 0;
      bestStreak = 0;
      totalScore = 0;
      totalTimeMs = 0;

      const subtitles = { teams: 'Ploegen Quiz', victories: 'Overwinningen Quiz', transfers: 'Transfers Quiz' };
      document.getElementById('headerSubtitle').textContent = subtitles[gameMode] || '';

      document.getElementById('startScreen').classList.add('hidden');
      document.getElementById('resultsScreen').classList.add('hidden');
      document.getElementById('quizScreen').classList.remove('hidden');

      showQuestion();
    }

    function generateTeamQuestions() {
      let pool;
      if (difficultyMode === '25') pool = famousRiders.slice(0, 25);
      else if (difficultyMode === '50') pool = famousRiders.slice(0, 50);
      else pool = allRiders;

      const selected = shuffle(pool).slice(0, QUESTIONS_PER_GAME);
      quizQuestions = selected.map(rider => {
        const correctTeam = riderTeamMap[rider];
        const wrongTeams = shuffle(teamNames.filter(t => t !== correctTeam)).slice(0, 3);
        return {
          prompt: rider,
          options: shuffle([correctTeam, ...wrongTeams]),
          correctAnswer: correctTeam,
          fact: riderFacts[rider] || ''
        };
      });
    }

    function generateVictoryQuestions() {
      const selected = shuffle([...victoriesData]).slice(0, QUESTIONS_PER_GAME);
      quizQuestions = selected.map(item => {
        const correctBase = getBaseRace(item.victory);
        const usedBases = new Set([correctBase]);
        const shuffled = shuffle(victoriesData.filter(d => d.rider !== item.rider));
        const wrongOptions = [];
        for (const d of shuffled) {
          const base = getBaseRace(d.victory);
          if (!usedBases.has(base)) {
            wrongOptions.push(d.victory);
            usedBases.add(base);
            if (wrongOptions.length === 3) break;
          }
        }
        return {
          prompt: item.rider,
          options: shuffle([item.victory, ...wrongOptions]),
          correctAnswer: item.victory,
          fact: item.desc
        };
      });
    }

    function generateTransferQuestions() {
      const selected = shuffle([...transfersData]).slice(0, QUESTIONS_PER_GAME);
      quizQuestions = selected.map(item => {
        const correctTeam = item.transferred ? item.to : item.team;
        let wrongTeams = [];
        if (item.transferred && item.trap && item.trap !== correctTeam) wrongTeams.push(item.trap);
        const pool = shuffle(teamNames.filter(t => t !== correctTeam && !wrongTeams.includes(t)));
        while (wrongTeams.length < 3) wrongTeams.push(pool.shift());
        let fact = item.transferred
          ? `Transfer! Van ${item.from} naar ${item.to}`
          : `Geen transfer ‚Äî rijdt nog steeds bij ${item.team}`;
        return {
          prompt: item.rider,
          options: shuffle([correctTeam, ...wrongTeams]),
          correctAnswer: correctTeam,
          fact: fact
        };
      });
    }

    // ========== QUIZ UI ==========
    function showQuestion() {
      answering = false;
      const q = quizQuestions[currentIndex];

      document.getElementById('riderName').textContent = q.prompt;
      document.getElementById('riderNum').textContent = `Vraag ${currentIndex + 1} van ${quizQuestions.length}`;
      document.getElementById('feedback').innerHTML = '';
      document.getElementById('riderFact').textContent = '';
      document.getElementById('riderFact').classList.add('hidden');
      document.getElementById('nextBtn').classList.add('hidden');
      document.getElementById('questionNum').textContent = `${currentIndex + 1}/${quizQuestions.length}`;
      document.getElementById('scoreDisplay').textContent = fmtScore(totalScore);
      document.getElementById('correctCount').textContent = correct;
      document.getElementById('streakCount').textContent = streak;
      document.getElementById('progressFill').style.width = `${(currentIndex / quizQuestions.length) * 100}%`;

      const card = document.getElementById('riderCard');
      card.classList.remove('correct', 'wrong');

      const grid = document.getElementById('optionsGrid');
      grid.innerHTML = '';
      q.options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.textContent = opt;
        btn.dataset.answer = opt;
        btn.addEventListener('click', () => handleAnswer(opt));
        grid.appendChild(btn);
      });

      questionStartTime = Date.now();
      startTimer();
    }

    function handleAnswer(chosen) {
      if (answering) return;
      answering = true;
      stopTimer();

      const elapsed = Date.now() - questionStartTime;
      totalTimeMs += elapsed;

      // Freeze timer display op huidige punten
      const pts = document.getElementById('timerPoints');
      const currentPts = calcPoints(elapsed);
      pts.textContent = fmtScore(currentPts) + ' punten';

      const q = quizQuestions[currentIndex];
      const card = document.getElementById('riderCard');
      const buttons = document.querySelectorAll('.option-btn');
      const isCorrect = chosen === q.correctAnswer;

      let points = 0;
      if (isCorrect) {
        points = calcPoints(elapsed);
        correct++;
        streak++;
        if (streak > bestStreak) bestStreak = streak;
        card.classList.add('correct');
        const streakTxt = streak > 1 ? ` ¬∑ ${streak} op rij!` : '';
        document.getElementById('feedback').innerHTML =
          `<span style="color:#2ECC71">+${fmtScore(points)}</span> <span class="pts">${fmtTime(elapsed)}${streakTxt}</span>`;
      } else {
        wrong++;
        streak = 0;
        card.classList.add('wrong');
        document.getElementById('feedback').innerHTML =
          `<span style="color:#C93C3B">${q.correctAnswer}</span>`;
      }

      totalScore += points;
      document.getElementById('scoreDisplay').textContent = fmtScore(totalScore);
      document.getElementById('correctCount').textContent = correct;
      document.getElementById('streakCount').textContent = streak;

      if (q.fact) {
        const factEl = document.getElementById('riderFact');
        factEl.textContent = q.fact;
        factEl.classList.remove('hidden');
      }

      buttons.forEach(btn => {
        btn.disabled = true;
        if (btn.dataset.answer === q.correctAnswer) {
          btn.classList.add(isCorrect ? 'correct-answer' : 'reveal-correct');
        } else if (btn.dataset.answer === chosen && !isCorrect) {
          btn.classList.add('wrong-answer');
        }
      });

      document.getElementById('nextBtn').classList.remove('hidden');
    }

    function nextQuestion() {
      currentIndex++;
      if (currentIndex >= quizQuestions.length) showResults();
      else showQuestion();
    }

    function showResults() {
      document.getElementById('quizScreen').classList.add('hidden');
      document.getElementById('resultsScreen').classList.remove('hidden');

      document.getElementById('finalScore').textContent = fmtScore(totalScore);
      document.getElementById('resultsDetail').textContent =
        `${correct} goed, ${wrong} fout ‚Äî ${fmtTime(totalTimeMs)} totaal\nBeste streak: ${bestStreak}`;

      const { lb, id } = saveLb(playerName, totalScore, totalTimeMs, correct);
      currentEntryId = id;
      renderLb(lb, id);
    }

    function showStart() {
      document.getElementById('quizScreen').classList.add('hidden');
      document.getElementById('resultsScreen').classList.add('hidden');
      document.getElementById('startScreen').classList.remove('hidden');
      showModeSelector();
    }

    function confirmHome() {
      if (confirm('Weet je zeker dat je wilt stoppen? Je voortgang gaat verloren.')) showStart();
    }

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
</body>
</html>
